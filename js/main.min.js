class GraphModal{constructor(e){this.options=Object.assign({isOpen:()=>{},isClose:()=>{}},e),this.modal=document.querySelector(".modal"),this.speed=300,this.animation="fade",this._reOpen=!1,this._nextContainer=!1,this.modalContainer=!1,this.isOpen=!1,this.previousActiveElement=!1,this._focusElements=["a[href]","input","select","textarea","button","iframe","[contenteditable]",'[tabindex]:not([tabindex^="-"])'],this._fixBlocks=document.querySelectorAll(".fix-block"),this.events()}events(){this.modal&&(document.addEventListener("click",function(e){const t=e.target.closest("[data-graph-path]");if(t){let e=t.dataset.graphPath,s=t.dataset.graphAnimation,o=t.dataset.graphSpeed;return this.animation=s||"fade",this.speed=o?parseInt(o):300,this._nextContainer=document.querySelector(`[data-graph-target="${e}"]`),void this.open()}e.target.closest(".modal__close")&&this.close()}.bind(this)),window.addEventListener("keydown",function(e){27==e.keyCode&&this.isOpen&&this.close(),9==e.which&&this.isOpen&&this.focusCatch(e)}.bind(this)),this.modal.addEventListener("click",function(e){e.target.classList.contains("modal__container")||e.target.closest(".modal__container")||!this.isOpen||this.close()}.bind(this)))}open(e){if(this.previousActiveElement=document.activeElement,this.isOpen)return this.reOpen=!0,void this.close();this.modalContainer=this._nextContainer,e&&(this.modalContainer=document.querySelector(`[data-graph-target="${e}"]`)),this.modal.style.setProperty("--transition-time",this.speed/1e3+"s"),this.modal.classList.add("is-open"),this.disableScroll(),this.modalContainer.classList.add("modal-open"),this.modalContainer.classList.add(this.animation),setTimeout(()=>{this.options.isOpen(this),this.modalContainer.classList.add("animate-open"),this.isOpen=!0,this.focusTrap()},this.speed)}close(){this.modalContainer&&(this.modalContainer.classList.remove("animate-open"),this.modalContainer.classList.remove(this.animation),this.modal.classList.remove("is-open"),this.modalContainer.classList.remove("modal-open"),this.enableScroll(),this.options.isClose(this),this.isOpen=!1,this.focusTrap(),this.reOpen&&(this.reOpen=!1,this.open()))}focusCatch(e){const t=this.modalContainer.querySelectorAll(this._focusElements),s=Array.prototype.slice.call(t),o=s.indexOf(document.activeElement);e.shiftKey&&0===o&&(s[s.length-1].focus(),e.preventDefault()),e.shiftKey||o!==s.length-1||(s[0].focus(),e.preventDefault())}focusTrap(){const e=this.modalContainer.querySelectorAll(this._focusElements);this.isOpen?e.length&&e[0].focus():this.previousActiveElement.focus()}disableScroll(){let e=window.scrollY;this.lockPadding(),document.body.classList.add("disable-scroll"),document.body.dataset.position=e,document.body.style.top=-e+"px"}enableScroll(){let e=parseInt(document.body.dataset.position,10);this.unlockPadding(),document.body.style.top="auto",document.body.classList.remove("disable-scroll"),window.scroll({top:e,left:0}),document.body.removeAttribute("data-position")}lockPadding(){let e=window.innerWidth-document.body.offsetWidth+"px";this._fixBlocks.forEach(t=>{t.style.paddingRight=e}),document.body.style.paddingRight=e}unlockPadding(){this._fixBlocks.forEach(e=>{e.style.paddingRight="0px"}),document.body.style.paddingRight="0px"}}let home=document.querySelector(".first-screen"),dishes=document.querySelector(".dishes"),contact=document.querySelector(".contact"),link=document.getElementsByClassName("link");function scroll(e){window.scrollTo({top:e.offsetTop,behavior:"smooth"}),menu.classList.remove("_active"),burger.classList.remove("_active"),body.classList.remove("_lock")}for(let e=0;e<link.length;e++)link[e].addEventListener("click",(function(){let e=this.dataset.block;"home"==e?scroll(home):"dishes"==e?scroll(dishes):"contact"==e&&scroll(contact)}));let body=document.querySelector(".body"),burger=document.querySelector(".header__burger"),menu=document.querySelector(".header__menu");burger.addEventListener("click",(function(){menu.classList.toggle("_active"),burger.classList.toggle("_active"),body.classList.toggle("_lock")}));let form=document.getElementById("form");async function formSend(e){e.preventDefault();formValidate(form),new FormData(form)}function formValidate(e){let t=0,s=document.querySelectorAll("._req");for(let e=0;e<s.length;e++){const o=s[e];formRemoveError(o),o.classList.contains("_phone-number")?phoneNumberValidation(o)||(formAddError(o),t++):""===o.value&&(formAddError(o),t++)}return t}function formAddError(e){e.parentElement.classList.add("_error"),e.classList.add("_error")}function formRemoveError(e){e.parentElement.classList.remove("_error"),e.classList.remove("_error")}function phoneNumberValidation(e){return/^\+380\d{3}\d{2}\d{2}\d{2}$/.test(e.value)}form.addEventListener("submit",formSend);let addButton=document.querySelectorAll(".basket-add"),basketButton=document.querySelector(".dishes-basket__button"),priceBlock=document.querySelector(".dishes-basket__price"),basketGoodsCount=document.querySelector(".dishes-basket__count"),cartContent=document.querySelector(".dishes-basket-popup__content"),cartBlock=document.querySelector(".dishes-basket-popup__block"),cleanCart=document.querySelector(".dishes-basket-popup__clean"),cartGoodsCount=document.querySelector(".dishes-basket-popup__count span"),cartPrice=document.querySelector(".dishes-basket-popup__total span"),cartEmpty=document.querySelector(".dishes-basket-popup__empty"),totalCount=0,totalPrice=0;function reloadCart(){let e=document.querySelectorAll(".popup-hide");if(cartGoodsCount.innerHTML=""+totalCount,basketGoodsCount.innerHTML=""+totalCount,cartPrice.innerHTML=totalPrice+" UAH",priceBlock.innerHTML=`= ${totalPrice} UAH`,0==totalCount){for(let t=0;t<e.length;t++)e[t].style.display="none";basketGoodsCount.classList.add("_unvisible"),cartEmpty.classList.add("_visible")}else{for(let t=0;t<e.length;t++)e[t].style.display="flex";basketGoodsCount.classList.remove("_unvisible"),cartEmpty.classList.remove("_visible")}}function increseAndProduceItem(e,t){let s=document.querySelectorAll(".dishes-basket-popup__number");for(let o=0;o<s.length;o++)if(e==s[o].dataset.id){let e=parseInt(s[o].dataset.count);"increase"==t&&e<20?(e++,s[o].dataset.count=""+e,totalCount++,totalPrice+=parseInt(s[o].dataset.price),s[o].innerHTML=""+e,reloadCart()):"reduce"==t&&e>1&&(console.log(e),e--,s[o].dataset.count=""+e,totalCount--,totalPrice-=parseInt(s[o].dataset.price),s[o].innerHTML=""+e,reloadCart())}}function removeCartData(e){let t=document.querySelectorAll(".dishes-basket-popup__item"),s=document.querySelectorAll(".dishes-basket-popup__number");document.querySelectorAll(".dishes-basket-popup__cont");for(let o=0;o<t.length;o++)e==t[o].dataset.id&&(totalCount-=parseInt(s[o].dataset.count),totalPrice-=parseInt(t[o].dataset.price*s[o].dataset.count),t[o].dataset.id="deleted",t[o].style.display="none",reloadCart())}function loadCartData(e){fetch("./../data.json").then(e=>e.json()).then(t=>{for(let s of t)s.id==e&&(cartBlock.innerHTML+=`\n\n                <div class="dishes-basket-popup__item" data-price="${s.price}" data-id="${s.id}"> \n                <img src="${s.image}" alt="" class="dishes-basket-popup__image">\n                <div class="dishes-basket-popup__info">\n                    <div class="dishes-basket-popup__caption">${s.title}</div>\n                    <div class="dishes-basket-popup__description">\n                        <div class="dishes-basket-popup__description-text">${s.description}, <span>${s.size} см</span></div>\n                    </div>\n                </div>\n                <div class="dishes-basket-popup__items-count count">\n                    <div class="count__remove dishes-basket-popup__remove" data-id="${s.id}"><span class="--svg__minus"></span></div>\n                    <div class="count__number dishes-basket-popup__number" data-price="${s.price}" data-count="1" data-id="${s.id}">1</div>  \n                    <div class="count__add dishes-basket-popup__add" data-id="${s.id}"><span class="--svg__plus"></div>\n                </div>\n                <div class="dishes-basket-popup__price">${s.price} UAH</div>\n                <div class="dishes-basket-popup__delete" data-id="${s.id}">\n                    delete\n                    <span class="--svg__delete"></span>\n                </div>\n                </div> \n                `,totalCount++,totalPrice=parseInt(totalPrice)+parseInt(s.price),reloadCart())}).then(()=>{let e=document.querySelectorAll(".dishes-basket-popup__delete");for(let t=0;t<e.length;t++)e[t].addEventListener("click",(function(){removeCartData(this.dataset.id)}));let t=document.querySelectorAll(".dishes-basket-popup__add");for(let e=0;e<t.length;e++)t[e].addEventListener("click",(function(){increseAndProduceItem(this.dataset.id,"increase")}));let s=document.querySelectorAll(".dishes-basket-popup__remove");for(let e=0;e<s.length;e++)s[e].addEventListener("click",(function(){increseAndProduceItem(this.dataset.id,"reduce")}))})}reloadCart(),basketButton.addEventListener("mouseover",(function(){priceBlock.classList.add("_active")})),basketButton.addEventListener("mouseout",(function(){priceBlock.classList.remove("_active")})),basketButton.addEventListener("click",(function(){(new GraphModal).open("dish-modal")})),cleanCart.addEventListener("click",(function(){cartBlock.innerHTML="",totalCount=0,totalPrice=0,reloadCart()}));const dishesBlock=document.querySelector(".dishes-block"),dishesMore=document.querySelector(".dishes__more");let dishQuantity=8,dataLength=null;if(dishesBlock){function loadDishes(e=8){fetch("./../data.json").then(e=>e.json()).then(t=>{dataLength=t.length,dishesBlock.innerHTML="";for(let s=0;s<dataLength;s++)if(s<e){let e=t[s];dishesBlock.innerHTML+=`\n                        <div class="dishes-block__item data-id="${e.id}">\n                            <img src="${e.image}" alt="" class="dishes-block__image">\n                            <div class="dishes-block__main">\n                                <div class="dishes-block__name">${e.title}</div>\n                                <div class="dishes-block__size">${e.size}</div>\n                            </div>\n                            <div class="dishes-block__description">${e.description}</div>\n                            <div class="dishes-block__price">${e.price} UAH  </div>\n                            <div class="dishes-block__add basket-add" data-id="${e.id}">\n                                <div class="basket-add__ico basket-add__off --svg__packet-orange"></div>\n                                <div class="basket-add__ico basket-add__on --svg__packet-white"></div>\n                            </div>\n                        </div>\n      \n                        `}}).then(()=>{let e=document.querySelectorAll(".basket-add");for(let t=0;t<e.length;t++)e[t].addEventListener("click",(function(){let e=document.querySelectorAll(".dishes-basket-popup__item"),t=this.dataset.id,s=!1;for(let o=0;o<e.length;o++)s=t==e[o].dataset.id;s?increseAndProduceItem(t,"increase"):loadCartData(t)}))})}loadDishes(dishQuantity),dishesMore.addEventListener("click",(function(e){dishQuantity+=4,loadDishes(dishQuantity),dishesMore.style.display=dishQuantity>=dataLength?"none":"block"}))}
//# sourceMappingURL=../sourcemaps/main.min.js.map
